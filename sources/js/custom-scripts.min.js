function jc_send_message(){jQuery(jc_button.find("i.fa")).removeClass("fa-check").removeClass("fa-remove").removeClass("fa-paper-plane").toggleClass("fa-spinner fa-spin"),jQuery.ajax({type:"post",url:"?jheck_chat_send_message",data:"send_message=1&"+jc_form.serialize(),contentType:"application/x-www-form-urlencoded",success:function(e){if("success"==e.status){if(jc_wrapper.find("#jheck_chat_msg-holder").fadeOut().empty(),0==clone_data.length)jQuery(jc_message_wrapper.find("ul")).load(document.location.href+" #jc_message_wrapper").fadeIn();else{var a=e.message.replace(/\r\n|\n|\r/g,"<br />"),t=clone_data.clone().appendTo(jc_message_wrapper.find("ul"));t.find(".sender-name").html("You"),t.find(".sender-message").html(a),t.find(".chat-date").text("just now")}old_count_counter.text(e.total_messages),jc_form_fields_wrapper.find("textarea").val(""),jQuery(jc_button.find("i.fa")).addClass("fa-check").toggleClass("fa-spinner fa-spin"),jQuery(jc_message_wrapper).animate({scrollTop:jQuery(jc_message_wrapper.find("ul"))[0].scrollHeight},500)}else"error"==e.status&&(jQuery(jc_button.find("i.fa")).addClass("fa-remove").toggleClass("fa-spinner fa-spin"),jc_wrapper.find("#jheck_chat_msg-holder").fadeIn().empty().append(e.msg))},error:function(e){jQuery(jc_button.find("i.fa")).addClass("fa-remove").toggleClass("fa-spinner fa-spin"),jc_wrapper.find("#jheck_chat_msg-holder").fadeIn().empty().append("Database connection error, Cant send new messages. Refresh your page")}})}var jc_wrapper=jQuery(".jheck_chat_main_wrapper"),jc_hidden_fields=jc_wrapper.find(".jc_hidden_fields"),jc_toggle=jc_wrapper.find(".jc_header button"),jc_message_wrapper=jc_wrapper.find(".jc_message_wrapper"),jc_form_fields_wrapper=jc_wrapper.find(".jc_form_fields_wrapper"),jc_form=jc_wrapper.find("form#jheck_chat_form"),jc_button=jc_form_fields_wrapper.find("button"),clone_data=jc_message_wrapper.find("ul li").last(),old_count_counter=jc_wrapper.find(".jheck_chat_old_count");jQuery(document).ready(function(){jQuery(jc_wrapper).find("#jheck_chat_new_message_alert_view").on("click",function(){return jQuery(jc_message_wrapper).animate({scrollTop:jQuery(jc_message_wrapper.find("ul"))[0].scrollHeight},500),jQuery(this).fadeOut(),!1});var e=parseInt(jc_hidden_fields.find("#jc_max_chatbox_message").val());jQuery(jc_form_fields_wrapper).find("textarea").on("keyup",function(){var a=jQuery(this).val().length,t=e-a;jQuery(this).next("#jheck_chat_message-counter").fadeIn().text(t+" characters remaining"),-1>=t?(jc_button.attr("disabled",!0),jc_button.find("i.fa").removeClass("fa-check").addClass("fa-remove").removeClass("fa-paper-plane")):(jc_button.attr("disabled",!1),jc_button.find("i.fa").removeClass("fa-check").removeClass("fa-remove").addClass("fa-paper-plane"))}),jQuery("#jheck_chat_message").keypress(function(a){a.which<32||(this.value.length==e?a.preventDefault():this.value.length>e&&(this.value=this.value.substring(0,e)))}),setInterval(function(){jQuery.ajax({type:"post",url:"?jheck_chat_fetch_new_count",data:"fetch_item=1",contentType:"application/x-www-form-urlencoded",success:function(e){"success"==e.status&&old_count_counter.text()<e.msg_count&&(old_count_counter.text(e.msg_count),jc_toggle.text("* New message - Chat"),jQuery(jc_wrapper).find("#jheck_chat_new_message_alert_view").fadeIn(),jQuery(jc_message_wrapper.find("#jc_message_wrapper_content")).load(document.location.href+" #jc_message"))},error:function(e){jc_wrapper.find("#jheck_chat_msg-holder").fadeIn().empty().append("Something went wrong, Cant fetch messages"),console.log("Something went wrong, Cant fetch messages")}})},2e3),jQuery(jc_message_wrapper).on("scroll",function(){jQuery(this).scrollTop()+jQuery(this).innerHeight()>=jQuery(this)[0].scrollHeight&&(jc_toggle.text("Chat"),jQuery(jc_wrapper).find("#jheck_chat_new_message_alert_view").fadeOut())}),jc_wrapper.find("#jheck_chat_user").on("keyup",function(){jQuery(this).val().length>=3?(jc_wrapper.find("textarea").fadeIn().attr("disabled",!1),jc_button.fadeIn().attr("disabled",!1),jc_wrapper.find("#jheck_chat_msg-holder").fadeOut().empty(),jc_wrapper.find("#jheck_chat_message-counter").fadeIn(),jc_wrapper.find(".jc_press_enter_to_submit").fadeIn()):(jc_wrapper.find("textarea").fadeOut().attr("disabled",!0),jc_button.fadeOut().attr("disabled",!0),jc_wrapper.find("#jheck_chat_msg-holder").fadeIn().empty().append("Minimum of 3 characters."),jc_wrapper.find("#jheck_chat_message-counter").fadeOut(),jc_wrapper.find(".jc_press_enter_to_submit").fadeOut())}),jQuery(jc_form_fields_wrapper).find("textarea").on("keydown",function(e){return jQuery("#jc_press_enter_to_submit_checkbox").is(":checked")&&13==e.which?(jc_send_message(),!1):void 0}),jQuery(jc_button).on("click",function(){"jheck-chat-submit-message"==jQuery(this).attr("type")?jc_send_message():console.log("Invalid submit button")}),jQuery("#jheck_chat_login_button").on("click",function(){return jQuery("#jheck_chat_user").slideToggle(),jQuery("#jheck_chat_loginform").slideToggle(),!1}),jQuery(function(){var e=jc_hidden_fields.find("#jc_chat_box_title").val();jc_toggle.text(e)}),jQuery(jc_toggle).on("click",function(){jc_wrapper.toggleClass("display-chatbox")})});